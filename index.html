<!--

 Dual licensed under the MIT and GPL licenses.
 - http://www.opensource.org/licenses/mit-license.php
 - http://www.gnu.org/copyleft/gpl.html
 
 Authors: Mark Boas - @maboa 

-->
<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<meta name="apple-mobile-web-app-capable" content="yes" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />  

<title>Greencorps</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="css/main.css" rel="stylesheet" type="text/css" />
<link href="skin/orman.css" rel="stylesheet" type="text/css" />
<link href="css/add2home.css" rel="stylesheet" type="text/css" />

<link rel="apple-touch-icon" href="icon-small.png" />
<link rel="apple-touch-icon" sizes="72x72" href="icon-med.png" />
<link rel="apple-touch-icon" sizes="114x114" href="icon-large.png" />
<!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script>-->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.jplayer.min.js"></script>
<script type="text/javascript" src="js/popcorn-ie8.js"></script>
<script type="text/javascript" src="js/popcorn.js"></script>
<script type="text/javascript" src="js/jquery.grab.js"></script>
<script type="text/javascript" src="js/popcorn.player.js"></script>
<script type="text/javascript" src="js/popcorn.jplayer.js"></script>
<script type="text/javascript" src="js/popcorn.code.js"></script>

<script type="text/javascript">
//<![CDATA[
$(document).ready(function(){

  var meridianHillData = [38.923127,-77.036394,38.919188,-77.036405,38.919238,-77.034817,38.920615,-77.034935,38.920882,-77.035225,38.923186,-77.035407];
  
  var marvinGayeData = [38.902515,-76.950327,38.900316,-76.954444,38.903914,-76.960246,38.906223,-76.947725,38.901895,-76.942335,38.899013,-76.9392,38.898673,-76.930617,38.898589,-76.929275,38.898406,-76.925622,38.895787,-76.921875,38.898406,-76.925622,38.895787,-76.921875,38.894541,-76.917755,38.891936,-76.913614,38.891886,-76.910663,38.889806,-76.914762,38.892913,-76.917809,38.894641,-76.921918,38.895025,-76.924761,38.895334,-76.926778,38.89652,-76.926435,38.897004,-76.929889,38.896779,-76.937732,38.898407,-76.93917,38.899109,-76.942592,38.892971,-76.942624,38.895209,-76.94918,38.898357,-76.946551,38.898482,-76.94315,38.90052,-76.943075,38.902064,-76.945746,38.902515,-76.950327];

  var meridianHill = [];
  var marvinGaye = [];

  for (i=0; i < meridianHillData.length; i += 2) {
    meridianHill.push(new google.maps.LatLng(meridianHillData[i],meridianHillData[i+1]));
  }

  for (i=0; i < marvinGayeData.length; i += 2) {
    marvinGaye.push(new google.maps.LatLng(marvinGayeData[i],marvinGayeData[i+1]));
  }

  var oxonRun = [
    new google.maps.LatLng(38.813279,-77.019769),
    new google.maps.LatLng(38.810135,-77.015027),
    new google.maps.LatLng(38.814964,-77.010133),
    new google.maps.LatLng(38.819137,-77.008815),
    new google.maps.LatLng(38.820358,-77.005134),
    new google.maps.LatLng(38.824412,-77.00552),
    new google.maps.LatLng(38.825716,-77.005274),
    new google.maps.LatLng(38.82921,-77.005692),
    new google.maps.LatLng(38.829327,-77.005349),
    new google.maps.LatLng(38.83389,-77.002677),
    new google.maps.LatLng(38.837434,-76.995042),
    new google.maps.LatLng(38.838659,-76.993119),
    new google.maps.LatLng(38.839769,-76.988389),
    new google.maps.LatLng(38.843649,-76.972749),
    new google.maps.LatLng(38.844563,-76.970248),
    new google.maps.LatLng(38.846854,-76.966078),
    new google.maps.LatLng(38.850531,-76.96052),
    new google.maps.LatLng(38.85079,-76.958439),
    new google.maps.LatLng(38.849837,-76.95831),
    new google.maps.LatLng(38.848876,-76.959705),
    new google.maps.LatLng(38.845208,-76.964061),
    new google.maps.LatLng(38.843328,-76.968159),
    new google.maps.LatLng(38.842509,-76.969575),
    new google.maps.LatLng(38.841197,-76.970369),
    new google.maps.LatLng(38.840236,-76.973717),
    new google.maps.LatLng(38.836204,-76.981855),
    new google.maps.LatLng(38.837608,-76.983558),
    new google.maps.LatLng(38.837608,-76.985361),
    new google.maps.LatLng(38.83668,-76.986981),
    new google.maps.LatLng(38.83795,-76.988225),
    new google.maps.LatLng(38.836839,-76.993118),
    new google.maps.LatLng(38.83592,-76.995832),
    new google.maps.LatLng(38.833204,-77.000327),
    new google.maps.LatLng(38.831081,-77.003535),
    new google.maps.LatLng(38.825414,-77.003439),
    new google.maps.LatLng(38.823976,-77.004361),
    new google.maps.LatLng(38.820715,-77.00234),
    new google.maps.LatLng(38.811375,-77.006817),
    new google.maps.LatLng(38.805418,-77.000611),
    new google.maps.LatLng(38.79693,-77.012649),
    new google.maps.LatLng(38.805859,-77.022219),
    new google.maps.LatLng(38.813499,-77.019704)
  ]

  meridianHillPoly = new google.maps.Polygon({
    paths: meridianHill,
    strokeColor: "#FF0000",
    strokeOpacity: 0.8,
    strokeWeight: 3,
    fillColor: "#FF0000",
    fillOpacity: 0.35
  });

  marvinGayePoly = new google.maps.Polygon({
    paths: marvinGaye,
    strokeColor: "#FF0000",
    strokeOpacity: 0.8,
    strokeWeight: 3,
    fillColor: "#FF0000",
    fillOpacity: 0.35
  });

  oxonRunPoly = new google.maps.Polygon({
    paths: oxonRun,
    strokeColor: "#FF0000",
    strokeOpacity: 0.8,
    strokeWeight: 3,
    fillColor: "#FF0000",
    fillOpacity: 0.35
  });

  

  var parkAudio = Popcorn( "#park-audio" )
  .code({
      start: 5,
      end: 18,
      onStart: function( options ) {
        oxonRunPoly.setMap(map);
        map.setZoom(13);
        map.setCenter(new google.maps.LatLng(38.826057,-76.990325));
      },
      onEnd: function( options ) {
        map.setZoom(12);
        map.setCenter(new google.maps.LatLng(38.88059,-77.004034));
      }
    })
  .code({
      start: 21,
      end: 40,
      onStart: function( options ) {
        meridianHillPoly.setMap(map);
        setTimeout(function () {
          map.setZoom(14);
          map.setCenter(new google.maps.LatLng(38.92155,-77.035781));
        }, 1500);
      },
      onEnd: function( options ) {
        map.setZoom(12);
        map.setCenter(new google.maps.LatLng(38.88059,-77.004034));
      }
  })
  .code({
      start: 60,
      onStart: function( options ) {
        var myLatlng = new google.maps.LatLng(38.897478,-76.925906);
        var marker = new google.maps.Marker({
            position: myLatlng, 
            map: map,
            title:"Isaiah"
        }); 
      }
  })
  .code({
      start: 46,
      end: 62,
      onStart: function( options ) {
        marvinGayePoly.setMap(map);
        setTimeout(function () {
          map.setZoom(14);
          map.setCenter(new google.maps.LatLng(38.899639,-76.936135));
        }, 500);
      },
      onEnd: function(){
        var isaiah = new google.maps.LatLng(38.897478,-76.925906);
        var panoramaOptions = {
          position: isaiah,
          pov: {
            heading: 90,
            pitch: 5,
            zoom: 1
          }
        };
        $('#pano').fadeIn('slow', function() {
          console.log('pano opend')
          var panorama = new google.maps.StreetViewPanorama(document.getElementById("pano"), panoramaOptions);
          map.setStreetView(panorama);

          // setTimeout

          setTimeout(function(){
            console.log('setting ...');
            /*myPlayer( "setMedia", {
              m4a: "http://videos-origin.mozilla.org/serv/webmademovies/silverhacks/Isaiah%20-Vimeo%20HD.mp4"
            });*/

            $('#jp_video_0').attr('src','http://videos-origin.mozilla.org/serv/webmademovies/silverhacks/Isaiah%20-Vimeo%20HD.mp4');

            console.log('playing ...');
            $('#pano').fadeOut('slow');
            $('#map_canvas').fadeOut('slow', function() {
              console.log('faded out map canvas');
              $('#jp_container_1').fadeIn('slow', function() {
                p.play();
              });
            });
          },7000);
        });
        
      }
  });

  var video = [],
      controlsVisible = true,
      myPlayer = $("#jquery_jplayer_1"),
      map;

  video['webm'] = "http://videos-origin.mozilla.org/serv/webmademovies/silverhacks/HackathonIntro4.mp4";
  video['mp4'] = "http://videos-origin.mozilla.org/serv/webmademovies/silverhacks/HackathonIntro4.mp4";

  myPlayer.bind($.jPlayer.event.ready, function() {
    
    if(!($.browser.msie && $.browser.version < 9)) {
        initGrabControl();
    }

    // check for touch on video to activate controls
    document.getElementsByClassName('player-hldr')[0].addEventListener('touchstart', function(e) {
      if (controlsVisible === false) {
        $('.jp-interface').fadeIn('fast',function() {
          controlsVisible = true;
        });
        e.preventDefault();
      }
        
    }, false);

    document.getElementsByClassName('player-hldr')[0].addEventListener('touchend', function(e) {
      if (controlsVisible === true) {
        $('.jp-interface').delay(1500).fadeOut('slow',function() {
          controlsVisible = false;
        });
        e.preventDefault();
      }
    }, false);
  });

  myPlayer.bind("jPlayerPopcornReady", function() {
    checkStartParam();
  });

  initPopcorn("#jquery_jplayer_1");

  function initGrabControl() {

    // jquery.grab event properties: event.position.x, event.position.y

    var dragEventPeriod = 250,
      dragEventOccurred = false,
      dragEventLimiterId = null,
      dragEventX = 0;

    $('#jp-play-drag').grab({

      onstart: function(){
        dragEventOccurred = false;
        clearInterval(dragEventLimiterId);
        dragEventLimiterId = setInterval(function() {
          if(dragEventOccurred) {
            grabBar(dragEventX);
            dragEventOccurred = false;
          }
        }, dragEventPeriod);
      }, onmove: function(event){
        dragEventX = event.position.x;
        dragEventOccurred = true;
      }, onfinish: function(event){
        clearInterval(dragEventLimiterId);
        dragEventOccurred = false;
      }
    });

    $('#jp-play-volume').grab({

      onstart: function(){
        //console.log('mooo');
        //console.log('jPlayerObj.css.jq.seekBar');
        dragEventOccurred = false;
        clearInterval(dragEventLimiterId);
        dragEventLimiterId = setInterval(function() {
          if(dragEventOccurred) {
            grabBarVol(dragEventX);
            dragEventOccurred = false;
          }
        }, dragEventPeriod);
      }, onmove: function(event){
        dragEventX = event.position.x;
        dragEventOccurred = true;
      }, onfinish: function(event){
        clearInterval(dragEventLimiterId);
        dragEventOccurred = false;
      }
    });
  }


  function grabBar(xDrag) { // Handles seekBar dragging
    var jPlayerObj = myPlayer.data("jPlayer");
    if(jPlayerObj.css.jq.seekBar) {
      var offset = jPlayerObj.css.jq.seekBar.offset();
      var x = xDrag - offset.left;
      var w = jPlayerObj.css.jq.seekBar.width();
      var p = 100*x/w;
      myPlayer.jPlayer("playHead", p);
    }

    _gaq.push(['_trackEvent', 'Greencorps', 'Progress bar', 'dragged']);
  }

  var volumeBar = $('.jp-volume-bar');

  var p;

  p.listen('ended', function(){
    console.log('boom ended');
  });

  function initPopcorn(id) {
    $('.panel-num').text('loading...');
    p = Popcorn.jplayer(id, video['mp4'], {
      size: {
          width: "100%",
          height: "100%",
          cssClass: "jp-video-full"
      },
      autohide: {full: false},
      fullScreen : true
    });
  }


  function checkStartParam() {
    if (getUrlVars()["s"] != null) {
      var s = parseInt(getUrlVars()["s"])/10;
      myPlayer.jPlayer("play",s);
      clearInstructions();
    }
  }


  myPlayer.bind($.jPlayer.event.timeupdate, function(event) {
    $('.jp-video-busy').hide();
  });

  myPlayer.bind($.jPlayer.event.pause, function(event) {
    $('.jp-video.play').show();

    _gaq.push(['_trackEvent', 'Greencorps', 'Pause', 'Clicked']);
  });


  myPlayer.bind($.jPlayer.event.play, function() {
    $('.jp-video-busy').show();
  });

  $('.jp-play').click(function() {

    $('.jp-video-busy').show();

    _gaq.push(['_trackEvent', 'Greencorps', 'Play', 'jPlayer Play clicked']);
  });

  $('.jp-progress').click(function() {
    $('.jp-video-busy').show();
    $('.fs-info:visible').hide();

    _gaq.push(['_trackEvent', 'Greencorps', 'Play', 'jPlayer Progress bar clicked']);
  });

  function grabBarVol(xDrag) { // Handles seekBar dragging
    var jPlayerObj = myPlayer.data("jPlayer");
    if(volumeBar) {
      var offset = volumeBar.offset();
      var x = xDrag - offset.left;
      var w = volumeBar.width();
      var v = x/w;
      myPlayer.jPlayer("volume", v); // Vol is a ratio, 0 to 1.
    }

    _gaq.push(['_trackEvent', 'Greencorps', 'Volume bar', 'dragged']);
  }

  var timeline = null;

  function initializeGoogleMap() {

    var myOptions = {
      zoom: 12,
      center: new google.maps.LatLng(38.88059,-77.004034),
      mapTypeId: google.maps.MapTypeId.SATELLITE
    };

    map = new google.maps.Map(document.getElementById('map_canvas'), myOptions);

  }

  myPlayer.bind($.jPlayer.event.ended, function() {
    $('#jp_container_1').fadeOut('fast', function() {
      console.log('faded out player');
      $('#map_canvas').fadeIn('fast', function() {
        initializeGoogleMap();
        parkAudio.play();
      });
    });
  });



  function checkStartParam() {
    if (getUrlVars()["s"] != null) {    

      var s = parseInt(getUrlVars()["s"]);    
      myPlayer.jPlayer("play",s);    
      _gaq.push(['_trackEvent', 'Greencorps', 'Start parameter', 'Triggered at '+s]);
    }
  }

});



$('.player-hldr').live('hover', function() {
    $('.jp-interface').fadeIn('fast');
});

$('.player-hldr').live('mouseleave', function() {
  $('.jp-interface').not(':hidden').fadeOut('slow');
});


var addToHomeConfig = {
  autostart: false
};

/*
if (top.location == self.location) {
  setTimeout(function () {
     addToHome.show();
  }, 1000);
}
*/

</script>
<script type="application/javascript" src="js/add2home.js"></script>

<!-- GA @start code -->
<script type="text/javascript">

  var _gaq = _gaq || [];

  _gaq.push(['_setAccount', 'UA-3557377-3']); // happyworm.com
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- GA @end code -->

</head>
<body>
  <div style="position:absolute; z-index:4; height:20px; width:200px;">
    <audio id="park-audio" preload="auto"> 
      <source src="http://videos-origin.mozilla.org/serv/webmademovies/silverhacks/hackathonaudio.mp3" >
      <source src="http://videos-origin.mozilla.org/serv/webmademovies/silverhacks/hackathonaudio.ogg" >
    </audio>
  </div>
  <div id="pano"></div>
  <div id="map_canvas"></div>
  <div class="app-hldr">
    <div class="player-hldr">
      <div id="jp_container_1" class="jp-video jp-video-full">
        <div id="jquery_jplayer_1" class="jp-jplayer"></div>
          <!--main containers for our controls-->
            <div class="jp-gui">
              <div class="jp-video-play">
                <span class="jp-video-play-icon"><img src="video-play.png"/></span>
              </div>

              <div class="jp-video-busy" style="display:none">
                <span class="jp-video-busy-icon"><img src="ajax-loader.gif"/></span>
              </div>

              <div id ="fstimeline" class="fullscreen-info" style="display:none"></div>
              <!--<div class="jp-screen-loader"></div>-->
                <div class="jp-interface">
                  <div class="jp-controls-holder">
                <!--play and pause buttons-->
                <a href="#" class="jp-play" tabindex="1">play</a>
                <a href="#" class="jp-pause" tabindex="1">pause</a>
                <span class="separator sep-1"></span>
                 
                <!--progress bar-->
                <div class="jp-progress">
                  <div class="jp-seek-bar">
                      <div class="jp-play-bar"><span id="jp-play-drag"></span></div>
                  </div>
                </div>
                 
                <!--time notifications-->
                <div class="jp-current-time"></div>
                <span class="time-sep">/</span>
                <div class="jp-duration"></div>
                <span class="separator sep-2"></span>
                 
                <!--mute / unmute toggle-->
                <a href="javascript:;" class="jp-mute" tabindex="2" title="mute">mute</a>
                <a href="javascript:;" class="jp-unmute" tabindex="2" title="unmute">unmute</a>
                 
                <!--volume bar-->
                <div class="jp-volume-bar">
                  <div class="jp-volume-bar-value"><span id="jp-play-volume" class="handle"></span></div>
                </div>
                 
                <!--full screen toggle-->
                <!--<a href="#" class="jp-full-screen" tabindex="3" title="full screen">full screen</a>
                <a href="#" class="jp-restore-screen" tabindex="3" title="restore screen">restore screen</a>

                <div class="jp-quality">
                  <a class="quality-btn" q="lo" href="#">low</a>
                  <a class="quality-btn" q="me" href="#" style="display:none">med</a>
                  <a class="quality-btn" q="hi" href="#" style="display:none">high</a>
                  <a class="quality-btn" q="hd" href="#" style="display:none">HD</a>
                </div>-->

                  </div><!--end jp-controls-holder-->
                </div><!--end jp-interface-->
            </div><!--end jp-gui-->

          <!--unsupported message-->
          <div class="jp-no-solution">
            <span>Update Required</span>
            The version of Flash you are using is not supported.
          </div>
      
        </div><!--end jp_container_1-->
      </div>
    </div> <!-- end .player-hldr -->

  </div> <!-- end .app-hldr -->
</body>

</html>
